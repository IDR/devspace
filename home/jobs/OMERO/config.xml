<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties/>
  <scm class="hudson.plugins.git.GitSCM" plugin="git@2.3.5">
    <configVersion>2</configVersion>
    <userRemoteConfigs>
      <hudson.plugins.git.UserRemoteConfig>
        <url>git://github.com/openmicroscopy/openmicroscopy.git</url>
      </hudson.plugins.git.UserRemoteConfig>
    </userRemoteConfigs>
    <branches>
      <hudson.plugins.git.BranchSpec>
        <name>metadata</name>
      </hudson.plugins.git.BranchSpec>
    </branches>
    <doGenerateSubmoduleConfigurations>false</doGenerateSubmoduleConfigurations>
    <browser class="hudson.plugins.git.browser.AssemblaWeb">
      <url></url>
    </browser>
    <submoduleCfg class="list"/>
    <extensions>
      <hudson.plugins.git.extensions.impl.SubmoduleOption>
        <disableSubmodules>false</disableSubmodules>
        <recursiveSubmodules>true</recursiveSubmodules>
        <trackingSubmodules>false</trackingSubmodules>
      </hudson.plugins.git.extensions.impl.SubmoduleOption>
      <hudson.plugins.git.extensions.impl.RelativeTargetDirectory>
        <relativeTargetDir>src</relativeTargetDir>
      </hudson.plugins.git.extensions.impl.RelativeTargetDirectory>
    </extensions>
  </scm>
  <canRoam>true</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers/>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.tasks.Shell>
      <command># FUTURE ENV. VARS
OMERO_DATA_DIR=$WORKSPACE/data
OMERO_DB_NAME=$JOB_NAME


#
eval $(bash /opt/multi-config.sh ice3.5)
cd src
source docs/hudson/functions.sh


# PURGE
dist/bin/omero admin stop || echo First build
sleep 5
mkdir -p $OMERO_DATA_DIR
rm -rf $OMERO_DATA_DIR/*
dropdb -h pg -U postgres $OMERO_DB_NAME || echo Already exists maybe
createdb -h pg -U postgres $OMERO_DB_NAME

pip install --user scc
$HOME/.local/bin/scc merge metadata --no-ask --reset --update-gitmodules -S none --push metadata/merge/trigger
./build.py clean
./build.py build-default test-compile
cd dist

# CONFIG HERE.
bin/omero config set omero.db.name $OMERO_DB_NAME
bin/omero config set omero.db.host pg
bin/omero config set omero.db.user postgres
bin/omero config set omero.data.dir $OMERO_DATA_DIR

bin/omero config set omero.web.check_version false
bin/omero config set omero.web.application_server.host 0.0.0.0
bin/omero config set omero.web.server_list &apos;[[&quot;localhost&quot;, 4064, &quot;metadata&quot;],[&quot;dogfish.openmicroscopy.org&quot;, 4064, &quot;dogfish&quot;]]&apos;
# DONE


# PURGE
bin/omero db script -f dbsetup.sql &quot;&quot; &quot;&quot; omero
psql -h pg -U postgres -d $OMERO_DB_NAME -f dbsetup.sql
rm dbsetup.sql

BUILD_ID=DONT_KILL_ME bin/omero admin start
BUILD_ID=DONT_KILL_ME bin/omero web start

bin/omero admin waitup
exit 0

export OMERO_SESSION_DIR=/tmp/$JOB_NAME/$BUILD_NUMBER
export ICE_CONFIG=$WORKSPACE/src/dist/etc/ice.config
echo Running the integration tests with -Dtestng.useDefaultListeners=true
cd $WORKSPACE/src
./build.py -f components/tools/OmeroJava/build.xml -Dtestng.useDefaultListeners=true -Dtestreports.dir=target/reports/integration integration
./build.py -f components/tools/OmeroJava/build.xml -Dtestng.useDefaultListeners=true -Dtestreports.dir=target/reports/broken broken
./build.py -f components/tools/OmeroPy/build.xml integration  -Dtestreports.dir=target/reports/integration
./build.py -f components/tools/OmeroPy/build.xml integration -DMARK=broken -Dtestreports.dir=target/reports/broken
./build.py -f components/tools/OmeroFS/build.xml integration
./build.py -f components/tools/OmeroWeb/build.xml integration</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers/>
  <buildWrappers/>
</project>